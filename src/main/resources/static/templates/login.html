<!DOCTYPE html>
<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.0.2
Version: 1.5.4
Author: KeenThemes
Website: http://www.keenthemes.com/
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>Metronic | Admin Dashboard Template</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <meta name="MobileOptimized" content="320">
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="../assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="../assets/plugins/select2/select2_metro.css" />
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME STYLES -->
    <link href="../assets/css/style-metronic.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/css/plugins.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="../assets/css/pages/login.css" rel="stylesheet" type="text/css"/>
    <link href="../assets/css/custom.css" rel="stylesheet" type="text/css"/>
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- BEGIN BODY -->
<body class="login">
<!-- BEGIN LOGO -->
<div class="logo">

</div>
<!-- END LOGO -->
<!-- BEGIN LOGIN -->
<div class="content">
    <!-- BEGIN LOGIN FORM -->
    <form class="login-form" onsubmit="usersLogin()">
        <h3 class="form-title">登录你的账户</h3>
        <div class="alert alert-danger display-hide">
            <button class="close" data-close="alert"></button>
            <span>请输入账号密码</span>
        </div>
        <div class="form-group">
            <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
            <label class="control-label visible-ie8 visible-ie9">账号</label>
            <div class="input-icon">
                <i class="fa fa-user"></i>
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="账号" id="accountNumber" name="accountNumber"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">密码</label>
            <div class="input-icon">
                <i class="fa fa-lock"></i>
                <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="密码" id="password" name="password"/>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn green pull-right">
                登录 <i class="m-icon-swapright m-icon-white"></i>
            </button>
        </div>
        <div class="forget-password">
            <h4>忘记密码 ?</h4>
            <p>
                点击这里 <a href="javascript:;"  id="forget-password">这里</a>
                重置密码.
            </p>
        </div>
        <div class="create-account">
            <p>
                你有账户么 ?&nbsp;
                <a href="javascript:;" id="register-btn" >创建一个账户</a>
            </p>
        </div>
    </form>
    <!-- END LOGIN FORM -->
    <!-- BEGIN FORGOT PASSWORD FORM -->
    <form class="forget-form" onsubmit="resertPassword()">
        <h3 >忘记密码 ?</h3>
        <p>请输入手机号重置密码.</p>
        <div class="form-group">
            <div class="input-icon">
                <i class="fa fa-envelope"></i>
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="手机号" id="resertPhoneNumber" name="resertPhoneNumber"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">验证码</label>
            <div class="input-icon">
                <i class="fa fa-location-arrow"></i>
                <input class="form-control placeholder-no-fix" type="text" placeholder="验证码" name="resertCode" id="resertCode" style="width: 50%;display: inline"/>
                <input type="button" class="btn btn-primary" value="获取验证码" id="resertSendBtn" style="width:41%;margin-left: 18px;border-color:#1e9fff !important;" onclick="resertSendCode(this)"></input>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">密码</label>
            <div class="input-icon">
                <i class="fa fa-lock"></i>
                <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="密码" name="resertpassword" id="resert_password"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">确认密码</label>
            <div class="controls">
                <div class="input-icon">
                    <i class="fa fa-check"></i>
                    <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="确认密码" name="rresertpassword" id="rresert_rpassword"/>
                </div>
            </div>
        </div>
        <div class="form-actions">
            <button type="button" id="back-btn" class="btn">
                <i class="m-icon-swapleft"></i> Back
            </button>
            <button type="submit" class="btn green pull-right" >
                Submit <i class="m-icon-swapright m-icon-white"></i>
            </button>
        </div>
    </form>
    <!-- END FORGOT PASSWORD FORM -->
    <!-- BEGIN REGISTRATION FORM -->
    <form class="register-form" onsubmit="userRegister()">
        <h3 >注册</h3>
        <p>请输入个人信息</p>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">名称</label>
            <div class="input-icon">
                <i class="fa fa-font"></i>
                <input class="form-control placeholder-no-fix" type="text" placeholder="名称" id="register_userName" name="register_userName"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">地址</label>
            <div class="input-icon">
                <i class="fa fa-check"></i>
                <input class="form-control placeholder-no-fix" type="text" placeholder="地址" id="register_address" name="register_address"/>
            </div>
        </div>

        <p>请输入账号详细信息</p>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">账号</label>
            <div class="input-icon">
                <i class="fa fa-user"></i>
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="账号" id="register_accountNumber" name="register_accountNumber"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">密码</label>
            <div class="input-icon">
                <i class="fa fa-lock"></i>
                <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="密码" name="register_password" id="register_password"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">确认密码</label>
            <div class="controls">
                <div class="input-icon">
                    <i class="fa fa-check"></i>
                    <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="确认密码" name="rregister_password" id="rregister_password"/>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">手机号</label>
            <div class="input-icon">
                <i class="fa fa-location-arrow"></i>
                <input class="form-control placeholder-no-fix" type="text" placeholder="手机号" id="register_phoneNumber" name="register_phoneNumber"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">验证码</label>
            <div class="input-icon">
                <i class="fa fa-location-arrow"></i>
                <input class="form-control placeholder-no-fix" type="text" placeholder="验证码" id="register_code" name="register_code" style="width: 50%;display: inline"/>
                <input type="button" class="btn btn-primary" value="获取验证码" id="register_sendBtn" style="width:41%;margin-left: 18px;border-color:#1e9fff !important;" onclick="sendCode(this)"></input>
            </div>
        </div>
        <div class="form-actions">
            <button id="register-back-btn" type="button" class="btn">
                <i class="m-icon-swapleft"></i>  Back
            </button>
            <button type="submit" id="register-submit-btn" class="btn green pull-right" >
                注册 <i class="m-icon-swapright m-icon-white"></i>
            </button>
        </div>
    </form>
    <!-- END REGISTRATION FORM -->
</div>
<!-- END LOGIN -->
<!-- BEGIN COPYRIGHT -->
<div class="copyright">
    2013 &copy; Metronic. Admin Dashboard Template.
</div>
<!-- END COPYRIGHT -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="../assets/plugins/respond.min.js"></script>
<script src="../assets/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="../assets/plugins/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="../assets/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<script src="../assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../assets/plugins/bootstrap-hover-dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript" ></script>
<script src="../assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="../assets/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="../assets/plugins/jquery.cookie.min.js" type="text/javascript"></script>
<script src="../assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript" ></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="../assets/plugins/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../assets/plugins/select2/select2.min.js"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="../assets/scripts/app.js" type="text/javascript"></script>
<script src="../assets/scripts/login.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>
    jQuery(document).ready(function() {
        App.init();
        Login.init();
    });
</script>
<!-- END JAVASCRIPTS -->
<script>
    function userRegister(){
        var userName=$("#register_userName").val();
        var address=$("#register_address").val();
        var password=$("#register_password").val();
        var phoneNumber=$("#register_phoneNumber").val();
        var register_code=$("#register_code").val();
        var accountNumber=$("#register_accountNumber").val();
        var rregister_password=$("#rregister_password").val();
        if(!(password==rregister_password)){
            return;
        }
        if(rregister_password==null||rregister_password==""){
            return;
        }
        if(userName==null||userName==""){
            return;
        }
        if(address==null||address==""){
            return;
        }
        if(password==null||password==""){
            return;
        }
        if(phoneNumber==null||phoneNumber==""){
            return;
        }if(register_code==null||register_code==""){
            return;
        }if(accountNumber==null||accountNumber==""){
            return;
        }
        $.ajax({
            url:"/users/register",
            type:"post",
            data:JSON.stringify({
                "userName":userName,
                "address":address,
                "password":password,
                "phoneNumber":phoneNumber,
                "code":register_code,
                "accountNumber":accountNumber
            }),
            contentType:"application/json",
            error: function (data) {
                alert("注册失败");
            },
            success:function (data) {
                if(data=="0"){
                    window.location.href="/users/toLogin";
                }
                if(data=="1"){
                    alert("注册失败")
                    return
                }
                if(data=="2"){
                    alert("账号已存在")
                    return
                }
                if(data=="3"){
                    alert("验证码错误")
                    return
                }
                if(data=="4"){
                    alert("手机号已被注册")
                    return
                }
            }
        });
    }
    function usersLogin() {
        var accountNumber=$("#accountNumber").val();
        var password=$("#password").val();
        if(accountNumber==null||accountNumber==""){
            return;
        }
        if(password==null||password==""){
            return;
        }
        $.ajax({
            url:"/users/check",
            type:"post",
            data:JSON.stringify({
                "accountNumber":accountNumber,
                "password":password
            }),
            contentType:"application/json",
            error: function (data) {
                alert("用户账户或密码错误");
            },
            success:function (data) {
                alert("登录成功");
                if(data.roleId==2){
                    window.location.href="/index/toAdminIndexPage";
                }else {
                    window.location.href="/index/toIndexPage";

                }

            }
        });
    }
    
    function resertPassword() {
        var resertPhoneNumber=$("#resertPhoneNumber").val();
        var resertCode=$("#resertCode").val();
        var resert_password=$("#resert_password").val();
        var rresert_rpassword=$("#rresert_rpassword").val();
        if(resertPhoneNumber==null||resertPhoneNumber==""){
            return;
        }
        if(resertCode==null||resertCode==""){
            return;
        }
        if(resert_password==null||resert_password==""){
            return;
        }
        if(rresert_rpassword==null||rresert_rpassword==""){
            return;
        }
        $.ajax({
            url:"/users/resertPassword",
            type:"post",
            data:JSON.stringify({
                "password":resert_password,
                "phoneNumber":resertPhoneNumber,
                "code":resertCode
            }),
            contentType:"application/json",
            error: function (data) {
                alert("修改失败");
                return;
            },
            success:function (data) {
                if(data=="0"){
                    window.location.href="/users/toLogin";
                }
                if(data=="1"){
                    alert("修改失败")
                    return
                }
                if(data=="2"){
                    alert("系统错误")
                    return
                }
                if(data=="3"){
                    alert("验证码错误")
                    return
                }
                if(data=="4"){
                    alert("手机号不存在")
                    return
                }

            }
        });
    }
    //重置验证码发送
    //验证码发送
    function resertSendCode(){
        var memPhone = $("#resertPhoneNumber").val();
        console.log(memPhone.length);
        if(memPhone == '' || memPhone.length != 11){
            alert("请输入正确的手机号！");
            return;
        }else{
            $.ajax({
                url: '/users/getCode?memPhone='+memPhone,
                type: 'GET',
                success: function(data) {
                    if(data){
                        resertTimer();
                    }else{
                        alert("获取验证码失败");
                    }
                },
                error: function(data) {
                    alert('连接超时！');
                },
            });
        }
    }
    //注册验证码发送
    function sendCode(){
        var memPhone = $("#register_phoneNumber").val();
        console.log(memPhone.length);
        if(memPhone == '' || memPhone.length != 11){
            alert("请输入正确的手机号！");
            return;
        }else{
            $.ajax({
                url: '/users/getCode?memPhone='+memPhone,
                type: 'GET',
                success: function(data) {
                    if(data){
                        timer();
                    }else{
                        alert("获取验证码失败");
                    }
                },
                error: function(data) {
                    alert('连接超时！');
                },
            });
        }
    }

    var wait = 60;
    //倒计时
    function timer() {
        if(wait == 0){
            $("#register_sendBtn").val("获取验证码");
            $("#register_sendBtn").removeAttr("disabled");
            $("#register_sendBtn").css("border-color","1e9fff").css("background", "#1C86EE").css("cursor", "pointer");
            wait = 60;
        }else{
            $("#register_sendBtn").attr("disabled","true");
            $("#register_sendBtn").css("border-color","fbfbfb").css("background", "#9C9C9C").css("cursor", "not-allowed");
            $("#register_sendBtn").val(wait + "秒后重发");
            wait--;
            setTimeout(function() {timer()}, 1000);
        }
    }
    //倒计时
    function resertTimer() {
        if(wait == 0){
            $("#resertSendBtn").val("获取验证码");
            $("#resertSendBtn").removeAttr("disabled");
            $("#resertSendBtn").css("border-color","1e9fff").css("background", "#1C86EE").css("cursor", "pointer");
            wait = 60;
        }else{
            $("#resertSendBtn").attr("disabled","true");
            $("#resertSendBtn").css("border-color","fbfbfb").css("background", "#9C9C9C").css("cursor", "not-allowed");
            $("#resertSendBtn").val(wait + "秒后重发");
            wait--;
            setTimeout(function() {timer()}, 1000);
        }
    }

</script>
</body>
<!-- END BODY -->
</html>